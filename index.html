<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Motivational Karaoke Video</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: black;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
    }

    canvas {
      background: black;
    }

    button {
      margin-top: 20px;
      padding: 14px 28px;
      font-size: 18px;
      font-weight: bold;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }

    @font-face {
      font-family: 'ImpactFont';
      src: local('Impact'), local('Arial Black'), sans-serif;
    }
  </style>
</head>
<body>
  <canvas id="karaokeCanvas" width="720" height="1280"></canvas>
  <button id="downloadBtn">Click Me</button>

  <script>
    const canvas = document.getElementById("karaokeCanvas");
    const ctx = canvas.getContext("2d");
    const downloadBtn = document.getElementById("downloadBtn");

    const quotes = [
      "Success doesn’t come from what you do occasionally. It comes from what you do consistently.",
      "Don’t wait for opportunity. Create it.",
      "Push yourself, because no one else is going to do it for you.",
      "Great things never come from comfort zones.",
      "Dream it. Wish it. Do it."
    ];

    const fontFamily = "Impact, Arial Black, sans-serif";
    const fontColor = "white";
    const karaokeColor = "yellow";
    const fontSize = 72;
    const fadeDuration = 1000; // in ms
    const karaokeDuration = 3000;
    const quoteDuration = karaokeDuration + fadeDuration + 1000;

    let currentQuoteIndex = 0;
    let animationStartTime;
    let mediaRecorder;
    let recordedChunks = [];

    ctx.textAlign = "center";
    ctx.textBaseline = "middle";

    function fitFontSize(text, maxWidth, baseFontSize) {
      let size = baseFontSize;
      ctx.font = `bold ${size}px ${fontFamily}`;
      while (ctx.measureText(text).width > maxWidth && size > 20) {
        size -= 2;
        ctx.font = `bold ${size}px ${fontFamily}`;
      }
      return size;
    }

    function drawKaraokeQuote(timeElapsed) {
      const quote = quotes[currentQuoteIndex];
      const centerX = canvas.width / 2;
      const centerY = canvas.height / 2;

      let progress = Math.min((timeElapsed - fadeDuration) / karaokeDuration, 1);
      const fadeProgress = Math.min(timeElapsed / fadeDuration, 1);

      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // Fit font dynamically
      const dynamicFontSize = fitFontSize(quote, canvas.width * 0.9, fontSize);
      ctx.font = `bold ${dynamicFontSize}px ${fontFamily}`;

      // Fade-in background text
      ctx.save();
      ctx.globalAlpha = fadeProgress;
      ctx.lineWidth = 6;
      ctx.strokeStyle = "black";
      ctx.strokeText(quote, centerX, centerY);
      ctx.fillStyle = fontColor;
      ctx.fillText(quote, centerX, centerY);
      ctx.restore();

      // Karaoke highlight
      const textWidth = ctx.measureText(quote).width;
      const karaokeWidth = textWidth * progress;

      if (progress > 0 && progress <= 1) {
        ctx.save();
        ctx.rect(centerX - textWidth / 2, centerY - dynamicFontSize / 2, karaokeWidth, dynamicFontSize);
        ctx.clip();

        ctx.lineWidth = 6;
        ctx.strokeStyle = "black";
        ctx.strokeText(quote, centerX, centerY);

        ctx.fillStyle = karaokeColor;
        ctx.fillText(quote, centerX, centerY);
        ctx.restore();
      }
    }

    function animate(timestamp) {
      const timeElapsed = timestamp - animationStartTime;

      drawKaraokeQuote(timeElapsed);

      if (timeElapsed < quoteDuration) {
        requestAnimationFrame(animate);
      } else {
        currentQuoteIndex++;
        if (currentQuoteIndex < quotes.length) {
          animationStartTime = performance.now();
          requestAnimationFrame(animate);
        } else {
          mediaRecorder.stop();
        }
      }
    }

    function startRecording() {
      const stream = canvas.captureStream(30);
      mediaRecorder = new MediaRecorder(stream, { mimeType: "video/webm" });

      recordedChunks = [];

      mediaRecorder.ondataavailable = (e) => {
        if (e.data.size > 0) recordedChunks.push(e.data);
      };

      mediaRecorder.onstop = () => {
        const blob = new Blob(recordedChunks, { type: "video/webm" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "motivational_karaoke.webm";
        a.click();
        URL.revokeObjectURL(url);
      };

      mediaRecorder.start();
      animationStartTime = performance.now();
      requestAnimationFrame(animate);
    }

    downloadBtn.addEventListener("click", () => {
      currentQuoteIndex = 0;
      startRecording();
    });
  </script>
</body>
</html>